# 注册系统安全优化实施计划

## 第一阶段：简化注册页面
- [x] 修改 register.html
  - [x] 只保留 email 字段
  - [x] 将 first_name, last_name, phone 转为隐藏的蜜罐字段
  - [x] 移除 password 相关字段
  - [x] 修改提交按钮文本和相关提示信息
## 完成的更改：
1. 移除了密码字段
2. 将姓名和电话设置为非必填的蜜罐字段
3. 简化了注册表单，只保留 email
4. 更新了后端逻辑以适应新的表单结构
5. user表格密码为空，is_active为false, 通过邮件链接激活（后续实现）

## 第二阶段：添加基础安全验证
- [X] 添加 Google reCAPTCHA v3
  - [X] 申请 reCAPTCHA 密钥
  - [X] 在页面添加 reCAPTCHA 脚本
  - [X] 实现验证逻辑
  - [x] 隐藏 reCAPTCHA badge
  - [x] 添加隐私政策声明

- [x] 实现邮箱域名验证
  - [x] 添加 DNS 查询功能
  - [x] 实现 MX 记录验证
  - [x] 配置日志系统
  - [x] 优化错误提示
  - [x] 在提交表单时验证邮箱域名

## 第三阶段：实现频率限制
- [X ] 添加 IP 限制
  - [X] 实现 IP 追踪
  - [X] 设置时间窗口限制（5分钟内最多5次尝试）
  - [X] 使用Django 缓存系统

- [X ] 添加设备限制
  - [X] 实现设备指纹追踪
  - [X] 设置设备访问限制（每天最多10次尝试）

## 第四阶段：邮件验证流程
- [X] 修改注册逻辑
  - [X] 生成唯一注册链接
  - [X] 实现邮件发送功能
  - [X] 存储临时注册信息

- [X] 创建验证链接页面
  - [X] 设计完整注册表单页面
  - [X] 实现链接验证逻辑
  - [X] 完成用户激活流程
## 第四阶段完成的更改：
1. 创建了 RegistrationToken 模型
2. 实现了 token 生成和验证功能
3. 创建了完整注册页面 (complete_registration.html)
4. 创建了验证成功页面 (registration_verified.html)
5. 优化了邮件发送逻辑
6. 实现了用户激活流程
7. 添加了表单提交时的加载状态
8. 将消息处理移至 base.html

## 第五阶段：数据库调整
- [X] 修改用户模型
  - [X] 添加必要的字段（如验证状态）
  - [X] 更新数据库结构

- [X] 清理现有数据
  - [X] 处理现有未验证用户
  - [X] 调整数据迁移策略
## 第五阶段完成的更改：
1. 确认现有数据库结构已经优化
2. User 模型使用 is_active 字段标记验证状态
3. Subscriber 模型保留必要字段：user, email, phone, credit, ip_address
4. RegistrationToken 模型管理验证流程
5. 移除了所有冗余字段
6. 完成了数据库结构的最终确认
